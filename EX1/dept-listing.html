<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>
    <title>Department List</title>
  </head>

  <body>
    <div class="container">
      <h2 class="container align-content-center mt-5 text-secondary">
        Department List
      </h2>
      <nav
        class="
          navbar navbar-expand-sm navbar-light
          bg-black bg-opacity-50
          mt-5
          mb-2
        "
      >
        <div class="container-fluid">
          <div class="collapse navbar-collapse" id="mynavbar">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <a href="./home.html" class="btn btn-primary"> Home </a>
                <button type="button" class="btn btn-primary" onclick="Add()">
                  Add
                </button>
              </li>
            </ul>
            <form class="d-flex">
              <input
                class="form-control me-2"
                type="text"
                id="search"
                placeholder="Search"
              />
              <button class="btn btn-primary" onclick="Search()" type="button">
                Search
              </button>
              <button class="btn btn-primary" onclick="Clear()" type="button">
                Clear
              </button>
            </form>
          </div>
        </div>
      </nav>
      <div class="message"></div>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>
              Department
              <button type="button" onclick="Sort()">
                <i class="fa fa-caret-down sort" aria-hidden="true"></i>
              </button>
            </th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="employee-list">
          <!-- <tr>
            <td>1</td>
            <td>Doe</td>
            <td>23</td>
            <td>
              <button type="button" onclick="Edit()">
                <i class="fa fa-pencil-square-o"></i>
              </button>
              <button type="button" onclick="Delete()">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr> -->
        </tbody>
      </table>
    </div>
    <script>
      function Add() {
        console.log("add");
        window.location.replace("./dept-edit.html" + `?_id=null`);
      }
      function DisplayList(department) {
        let List = department.map((d) => {
          return `<tr>
            <td>${d._id}</td>
            <td>${d.name}</td>
            <td>
              <button type="button" onclick="Edit(${d._id})">
                <i class="fa fa-pencil-square-o"></i>
              </button>
              <button type="button" onclick="Delete(${d._id})">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr>`;
        });
        document.getElementById("employee-list").innerHTML = List.join("");
      }

      function messageAlert(msg) {
        document.querySelector(
          ".message"
        ).innerHTML = `<div class="alert alert-warning">
                        <strong>${msg}</strong>
                      </div>`;
        setTimeout(() => {
          document.querySelector(".message").innerHTML = "";
        }, 3000);
      }

      window.addEventListener("DOMContentLoaded", () => {
        let department = JSON.parse(localStorage.getItem("Department"));
        if (department !== null && department.length !== 0) {
          DisplayList(department);
        } else {
          messageAlert(
            "There is no Employee data on the local storage, please add ..."
          );
        }
      });

      function Sort() {
        let department = JSON.parse(localStorage.getItem("Department"));
        element = document.querySelector(".sort");
        if (element.classList.contains("fa-caret-down")) {
          department.sort((a, b) =>
            a.name.toLowerCase() > b.name.toLowerCase()
              ? 1
              : b.name.toLowerCase() > a.name.toLowerCase()
              ? -1
              : 0
          );
          element.classList.remove("fa-caret-down");
          element.classList.add("fa-caret-up");
          DisplayList(department);
        } else {
          department.sort((a, b) =>
            a.name.toLowerCase() > b.name.toLowerCase()
              ? -1
              : b.name.toLowerCase() > a.name.toLowerCase()
              ? 1
              : 0
          );
          element.classList.remove("fa-caret-up");
          element.classList.add("fa-caret-down");
          DisplayList(department);
        }
      }

      function Search() {
        let department = JSON.parse(localStorage.getItem("Department"));
        let search = document.getElementById("search").value;
        let searchResult = department.filter((e) => {
          if (e.name.includes(search)) {
            return true;
          }
        });
        if (searchResult.length === 0) {
          DisplayList(searchResult);
          messageAlert("Not found");
        } else {
          DisplayList(searchResult);
        }
      }

      function Clear() {
        let department = JSON.parse(localStorage.getItem("Department"));
        document.getElementById("search").value = "";
        DisplayList(department);
      }

      function Edit(_id) {
        window.location.replace("./dept-edit.html" + `?_id=${_id}`);
      }

      function Delete(_id) {
        if (confirm("Do you want to delete ?")) {
          let department = JSON.parse(localStorage.getItem("Department"));
          let newDepartment = department.filter((employee) => {
            return employee._id !== String(_id);
          });
          localStorage.setItem("Department", JSON.stringify(newDepartment));
          DisplayList(newDepartment);
        }
      }
    </script>
  </body>
</html>
