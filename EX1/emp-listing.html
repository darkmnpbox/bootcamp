<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js"></script>
    <title>Employees List</title>
  </head>

  <body>
    <div class="container">
      <h2 class="container align-content-center mt-5 text-secondary">
        Employees List
      </h2>
      <nav
        class="
          navbar navbar-expand-sm navbar-light
          bg-black bg-opacity-50
          mt-5
          mb-2
        "
      >
        <div class="container-fluid">
          <div class="collapse navbar-collapse" id="mynavbar">
            <ul class="navbar-nav me-auto">
              <li class="nav-item">
                <button type="button" class="btn btn-primary" onclick="Add()">
                  Add
                </button>
              </li>
            </ul>
            <form class="d-flex">
              <input
                class="form-control me-2"
                type="text"
                id="search"
                placeholder="Search"
              />
              <button class="btn btn-primary" onclick="Search()" type="button">
                Search
              </button>
              <button class="btn btn-primary" onclick="Clear()" type="button">
                Clear
              </button>
            </form>
          </div>
        </div>
      </nav>
      <div class="message"></div>
      <table class="table table-hover">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Age</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="employee-list">
          <!-- <tr>
            <td>1</td>
            <td>Doe</td>
            <td>23</td>
            <td>
              <button type="button" onclick="Edit()">
                <i class="fa fa-pencil-square-o"></i>
              </button>
              <button type="button" onclick="Delete()">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr> -->
        </tbody>
      </table>
    </div>
    <script>
      function Add() {
        console.log("add");
        window.location.replace(
          "http://127.0.0.1:5500/emp-edit.html" + `?_id=null`
        );
      }
      function DisplayList(employees) {
        let List = employees.map((employee) => {
          return `<tr>
            <td>${employee._id}</td>
            <td>${employee.name}</td>
            <td>${employee.age}</td>
            <td>
              <button type="button" onclick="Edit(${employee._id})">
                <i class="fa fa-pencil-square-o"></i>
              </button>
              <button type="button" onclick="Delete(${employee._id})">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr>`;
        });
        document.getElementById("employee-list").innerHTML = List.join("");
      }

      function messageAlert(msg) {
        document.querySelector(
          ".message"
        ).innerHTML = `<div class="alert alert-warning">
                        <strong>${msg}</strong>
                      </div>`;
      }

      window.addEventListener("DOMContentLoaded", () => {
        employees = JSON.parse(localStorage.getItem("Employees"));
        if (employees !== null) {
          DisplayList(employees);
        } else {
          messageAlert(
            "There is no Employee data on the local storage, please add ..."
          );
        }
      });

      function Search() {
        console.log("search");
      }

      function Clear() {
        document.getElementById("search").value = "";
      }

      function Edit(_id) {
        window.location.replace(
          "http://127.0.0.1:5500/emp-edit.html" + `?_id=${_id}`
        );
      }

      function Delete(_id) {
        window.event.preventDefault();
        if (confirm("Do you want to delete ?")) {
          employees = JSON.parse(localStorage.getItem("Employees"));
          console.log(employees);
          newEmployees = employees.filter((employee) => {
            return employee._id !== _id;
          });
          console.log(newEmployees);
          localStorage.setItem("Employees", JSON.stringify(newEmployees));
          DisplayList(newEmployees);
        }
      }
    </script>
  </body>
</html>
